<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Daños por Caída</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
        }

        .header h1 {
            color: #e74c3c;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #555;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .panel h2 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel h2 i {
            color: #3498db;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider-value {
            font-weight: bold;
            color: #e74c3c;
            min-width: 50px;
        }

        input[type="range"] {
            flex-grow: 1;
            height: 10px;
            border-radius: 5px;
            background: #ecf0f1;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }

        select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #ddd;
            background: white;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        select:focus {
            border-color: #3498db;
            outline: none;
        }

        .ppe-indicators {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .ppe-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #ecf0f1;
            transition: all 0.3s;
        }

        .ppe-item.active {
            background: #d4edda;
            border-color: #28a745;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.2);
        }

        .ppe-item i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .ppe-item.helmet i { color: #3498db; }
        .ppe-item.harness i { color: #e74c3c; }
        .ppe-item.airbag i { color: #f39c12; }
        .ppe-item.boots i { color: #2ecc71; }

        .button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .button:hover {
            background: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(231, 76, 60, 0.4);
        }

        .simulation-area {
            position: relative;
            height: 500px;
            overflow: hidden;
            border-radius: 15px;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FF);
        }

        .building {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            background: linear-gradient(to right, #95a5a6, #7f8c8d);
            border: 5px solid #5d6d7e;
        }

        .building-floor {
            height: 40px;
            border-bottom: 2px solid #5d6d7e;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80px;
            background: linear-gradient(to top, #27ae60, #2ecc71);
        }

        .worker {
            position: absolute;
            transition: top 0.5s linear, left 0.1s;
            transform-origin: center;
        }

        .worker-icon {
            font-size: 3rem;
            color: #3498db;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .fall-line {
            position: absolute;
            width: 3px;
            background: rgba(231, 76, 60, 0.7);
            left: 50%;
            transform: translateX(-50%);
        }

        .impact-zone {
            position: absolute;
            border-radius: 50%;
            background: rgba(231, 76, 60, 0.3);
            transform: translate(-50%, 50%);
        }

        .results {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }

        .results h2 {
            color: #2c3e50;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .results h2 i {
            color: #e74c3c;
        }

        .risk-level {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .risk-metric {
            text-align: center;
        }

        .risk-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e74c3c;
        }

        .risk-label {
            font-size: 1rem;
            color: #7f8c8d;
        }

        .injury-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .injury-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #e74c3c;
        }

        .injury-severity {
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 5px;
        }

        .injury-desc {
            color: #555;
            font-size: 0.9rem;
        }

        .protection-effectiveness {
            margin-top: 20px;
            padding: 15px;
            background: #d4edda;
            border-radius: 10px;
            border-left: 5px solid #28a745;
        }

        .protection-effectiveness h3 {
            color: #155724;
            margin-bottom: 10px;
        }

        .warning {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
        }

        .warning h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .warning p {
            color: #856404;
        }

        .footer {
            text-align: center;
            color: white;
            padding: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .hidden {
            display: none;
        }

        .animation-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .animation-controls button {
            flex: 1;
            padding: 12px;
        }

        .slow-motion {
            background: #3498db;
        }

        .slow-motion:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-user-injured"></i> Simulador de Daños por Caída</h1>
            <p>Herramienta educativa para visualizar los efectos de caídas desde diferentes alturas y la efectividad de los equipos de protección personal (EPP)</p>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2><i class="fas fa-sliders-h"></i> Configuración de Simulación</h2>
                
                <div class="control-group">
                    <label>Altura de caída: <span class="slider-value" id="heightValue">3 metros</span></label>
                    <div class="slider-container">
                        <span>1m</span>
                        <input type="range" id="heightSlider" min="1" max="15" step="0.5" value="3">
                        <span>15m</span>
                    </div>
                    <div class="building-reference">
                        <p><small><i class="fas fa-building"></i> Referencia: 3m ≈ 1 piso | 6m ≈ 2 pisos | 9m ≈ 3 pisos</small></p>
                    </div>
                </div>

                <div class="control-group">
                    <label>Peso del trabajador: <span class="slider-value" id="weightValue">70 kg</span></label>
                    <div class="slider-container">
                        <span>50kg</span>
                        <input type="range" id="weightSlider" min="50" max="120" step="5" value="70">
                        <span>120kg</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Superficie de impacto:</label>
                    <select id="surfaceSelect">
                        <option value="concrete">Concreto (más peligroso)</option>
                        <option value="soil">Suelo de tierra</option>
                        <option value="wood">Madera</option>
                        <option value="safetyMat">Colchoneta de seguridad</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Posición de caída:</label>
                    <select id="positionSelect">
                        <option value="feet">De pie (pies primero)</option>
                        <option value="side">De lado</option>
                        <option value="back">Espalda primero</option>
                        <option value="head">Cabeza primero (más peligroso)</option>
                    </select>
                </div>

                <h3 style="margin-top: 25px; margin-bottom: 15px;"><i class="fas fa-hard-hat"></i> Equipos de Protección Personal</h3>
                <div class="ppe-indicators">
                    <div class="ppe-item helmet" id="ppeHelmet">
                        <i class="fas fa-hard-hat"></i>
                        <div>Casco</div>
                    </div>
                    <div class="ppe-item harness" id="ppeHarness">
                        <i class="fas fa-user-check"></i>
                        <div>Arnés anticaídas</div>
                    </div>
                    <div class="ppe-item airbag" id="ppeAirbag">
                        <i class="fas fa-air-freshener"></i>
                        <div>Sistema de airbag</div>
                    </div>
                    <div class="ppe-item boots" id="ppeBoots">
                        <i class="fas fa-shoe-prints"></i>
                        <div>Botas de seguridad</div>
                    </div>
                </div>

                <button class="button" id="simulateButton">
                    <i class="fas fa-play-circle"></i> Simular Caída
                </button>
                
                <div class="animation-controls">
                    <button class="button slow-motion" id="slowMotionButton">
                        <i class="fas fa-tachometer-alt"></i> Cámara Lenta
                    </button>
                    <button class="button" id="resetButton">
                        <i class="fas fa-redo"></i> Reiniciar
                    </button>
                </div>
            </div>

            <div class="panel">
                <h2><i class="fas fa-running"></i> Simulación Visual</h2>
                <div class="simulation-area" id="simulationArea">
                    <!-- Aquí se dibujará la simulación con JS -->
                </div>
            </div>
        </div>

        <div class="results hidden" id="resultsPanel">
            <h2><i class="fas fa-file-medical-alt"></i> Resultados del Impacto</h2>
            
            <div class="risk-level">
                <div class="risk-metric">
                    <div class="risk-value" id="riskValue">7.8</div>
                    <div class="risk-label">Índice de Riesgo</div>
                </div>
                <div class="risk-metric">
                    <div class="risk-value" id="energyValue">2058</div>
                    <div class="risk-label">Energía (Joules)</div>
                </div>
                <div class="risk-metric">
                    <div class="risk-value" id="speedValue">7.7</div>
                    <div class="risk-label">Velocidad (m/s)</div>
                </div>
                <div class="risk-metric">
                    <div class="risk-value" id="severityValue">Grave</div>
                    <div class="risk-label">Gravedad</div>
                </div>
            </div>

            <h3><i class="fas fa-user-injured"></i> Lesiones Probables</h3>
            <div class="injury-list" id="injuryList">
                <!-- Las lesiones se generarán con JS -->
            </div>

            <div class="protection-effectiveness" id="protectionEffect">
                <!-- Efectividad de protección se generará con JS -->
            </div>
        </div>

        <div class="warning">
            <h3><i class="fas fa-exclamation-triangle"></i> Advertencia Educativa</h3>
            <p>Este simulador tiene fines exclusivamente educativos y de concientización sobre seguridad en el trabajo. Los cálculos son aproximados y basados en principios físicos básicos. Siempre consulte con profesionales en seguridad industrial y cumpla con todas las normativas de seguridad antes de realizar trabajos en altura.</p>
        </div>

        <div class="footer">
            <p>Simulador de Daños por Caída © 2023 | Herramienta Educativa de Seguridad Industrial</p>
        </div>
    </div>

    <script>
        // Elementos DOM
        const heightSlider = document.getElementById('heightSlider');
        const heightValue = document.getElementById('heightValue');
        const weightSlider = document.getElementById('weightSlider');
        const weightValue = document.getElementById('weightValue');
        const surfaceSelect = document.getElementById('surfaceSelect');
        const positionSelect = document.getElementById('positionSelect');
        const simulateButton = document.getElementById('simulateButton');
        const slowMotionButton = document.getElementById('slowMotionButton');
        const resetButton = document.getElementById('resetButton');
        const simulationArea = document.getElementById('simulationArea');
        const resultsPanel = document.getElementById('resultsPanel');
        const riskValue = document.getElementById('riskValue');
        const energyValue = document.getElementById('energyValue');
        const speedValue = document.getElementById('speedValue');
        const severityValue = document.getElementById('severityValue');
        const injuryList = document.getElementById('injuryList');
        const protectionEffect = document.getElementById('protectionEffect');
        
        // Elementos de protección personal
        const ppeHelmet = document.getElementById('ppeHelmet');
        const ppeHarness = document.getElementById('ppeHarness');
        const ppeAirbag = document.getElementById('ppeAirbag');
        const ppeBoots = document.getElementById('ppeBoots');
        
        // Estado de simulación
        let simulationActive = false;
        let slowMotion = false;
        let selectedPPE = {
            helmet: false,
            harness: false,
            airbag: false,
            boots: false
        };
        
        // Actualizar valores de los sliders
        heightSlider.addEventListener('input', () => {
            heightValue.textContent = `${heightSlider.value} metros`;
        });
        
        weightSlider.addEventListener('input', () => {
            weightValue.textContent = `${weightSlider.value} kg`;
        });
        
        // Toggle de elementos de protección
        ppeHelmet.addEventListener('click', () => {
            ppeHelmet.classList.toggle('active');
            selectedPPE.helmet = !selectedPPE.helmet;
        });
        
        ppeHarness.addEventListener('click', () => {
            ppeHarness.classList.toggle('active');
            selectedPPE.harness = !selectedPPE.harness;
        });
        
        ppeAirbag.addEventListener('click', () => {
            ppeAirbag.classList.toggle('active');
            selectedPPE.airbag = !selectedPPE.airbag;
        });
        
        ppeBoots.addEventListener('click', () => {
            ppeBoots.classList.toggle('active');
            selectedPPE.boots = !selectedPPE.boots;
        });
        
        // Iniciar simulación
        simulateButton.addEventListener('click', startSimulation);
        slowMotionButton.addEventListener('click', () => {
            slowMotion = !slowMotion;
            slowMotionButton.innerHTML = slowMotion ? 
                '<i class="fas fa-tachometer-alt"></i> Velocidad Normal' : 
                '<i class="fas fa-tachometer-alt"></i> Cámara Lenta';
        });
        
        resetButton.addEventListener('click', resetSimulation);
        
        // Función para iniciar simulación
        function startSimulation() {
            if (simulationActive) return;
            
            simulationActive = true;
            simulateButton.disabled = true;
            
            // Limpiar área de simulación
            simulationArea.innerHTML = '';
            
            // Obtener valores de entrada
            const height = parseFloat(heightSlider.value);
            const weight = parseFloat(weightSlider.value);
            const surface = surfaceSelect.value;
            const position = positionSelect.value;
            
            // Calcular valores físicos
            const gravity = 9.81; // m/s²
            const velocity = Math.sqrt(2 * gravity * height); // v = √(2gh)
            const energy = weight * gravity * height; // E = mgh (Joules)
            
            // Calcular índice de riesgo
            const riskIndex = calculateRiskIndex(height, weight, surface, position, selectedPPE);
            
            // Determinar gravedad de lesiones
            const severity = getSeverityLevel(riskIndex);
            
            // Mostrar resultados iniciales
            updateResults(riskIndex, energy, velocity, severity);
            
            // Dibujar escenario
            drawBuilding(height);
            drawWorker(height, position);
            
            // Animar caída
            animateFall(height, riskIndex, severity);
        }
        
        // Función para dibujar edificio de referencia
        function drawBuilding(height) {
            const building = document.createElement('div');
            building.className = 'building';
            
            // Calcular número de pisos (cada 3m es un piso)
            const floors = Math.ceil(height / 3);
            const buildingHeight = floors * 40; // 40px por piso
            
            building.style.height = `${buildingHeight}px`;
            
            // Crear pisos
            for (let i = floors; i > 0; i--) {
                const floor = document.createElement('div');
                floor.className = 'building-floor';
                floor.textContent = `${i}`;
                building.appendChild(floor);
            }
            
            // Añadir etiqueta de altura
            const heightLabel = document.createElement('div');
            heightLabel.className = 'building-floor';
            heightLabel.style.background = '#3498db';
            heightLabel.textContent = `${height}m`;
            building.appendChild(heightLabel);
            
            // Suelo
            const ground = document.createElement('div');
            ground.className = 'ground';
            
            simulationArea.appendChild(building);
            simulationArea.appendChild(ground);
        }
        
        // Función para dibujar trabajador
        function drawWorker(height, position) {
            const worker = document.createElement('div');
            worker.className = 'worker';
            worker.id = 'worker';
            
            // Posicionar trabajador en la altura correspondiente
            const floors = Math.ceil(height / 3);
            const buildingHeight = floors * 40;
            const workerTop = buildingHeight - 60; // Posicionar un poco más abajo del techo
            
            worker.style.top = `${workerTop}px`;
            worker.style.left = '50%';
            worker.style.transform = 'translateX(-50%)';
            
            // Icono según posición de caída
            let iconClass = 'fas fa-user';
            if (position === 'feet') iconClass = 'fas fa-user';
            else if (position === 'side') iconClass = 'fas fa-user';
            else if (position === 'back') iconClass = 'fas fa-user';
            else if (position === 'head') iconClass = 'fas fa-user';
            
            const workerIcon = document.createElement('i');
            workerIcon.className = `worker-icon ${iconClass}`;
            
            // Añadir iconos de EPP seleccionados
            if (selectedPPE.helmet) {
                const helmetIcon = document.createElement('i');
                helmetIcon.className = 'fas fa-hard-hat';
                helmetIcon.style.position = 'absolute';
                helmetIcon.style.top = '-15px';
                helmetIcon.style.left = '50%';
                helmetIcon.style.transform = 'translateX(-50%)';
                helmetIcon.style.fontSize = '1.5rem';
                helmetIcon.style.color = '#e74c3c';
                worker.appendChild(helmetIcon);
            }
            
            if (selectedPPE.harness) {
                const harnessIcon = document.createElement('i');
                harnessIcon.className = 'fas fa-user-check';
                harnessIcon.style.position = 'absolute';
                harnessIcon.style.top = '10px';
                harnessIcon.style.right = '-20px';
                harnessIcon.style.fontSize = '1.2rem';
                harnessIcon.style.color = '#e74c3c';
                worker.appendChild(harnessIcon);
            }
            
            worker.appendChild(workerIcon);
            simulationArea.appendChild(worker);
        }
        
        // Función para animar la caída
        function animateFall(height, riskIndex, severity) {
            const worker = document.getElementById('worker');
            const building = document.querySelector('.building');
            const buildingHeight = building.offsetHeight;
            const groundLevel = simulationArea.offsetHeight - 80; // Altura del suelo
            
            // Calcular posición inicial y final
            const startTop = parseInt(worker.style.top);
            const endTop = groundLevel - 30; // Ajuste para que quede sobre el suelo
            
            // Duración de la animación basada en altura
            const fallTime = Math.sqrt(2 * height / 9.81) * 1000; // Tiempo en ms
            const animationTime = slowMotion ? fallTime * 3 : fallTime;
            
            // Línea de trayectoria
            const fallLine = document.createElement('div');
            fallLine.className = 'fall-line';
            fallLine.style.top = `${startTop + 30}px`;
            fallLine.style.height = '0px';
            simulationArea.appendChild(fallLine);
            
            // Animar caída
            let startTime = null;
            let animationFrame;
            
            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / animationTime, 1);
                
                // Calcular posición actual (física de caída libre)
                const currentTop = startTop + (endTop - startTop) * progress;
                worker.style.top = `${currentTop}px`;
                
                // Actualizar línea de trayectoria
                fallLine.style.height = `${currentTop - startTop}px`;
                
                // Rotar trabajador durante la caída
                const rotation = progress * 720; // Dos rotaciones completas
                worker.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
                
                if (progress < 1) {
                    animationFrame = requestAnimationFrame(step);
                } else {
                    // Caída completada
                    showImpact(riskIndex, severity, endTop);
                    simulationActive = false;
                    simulateButton.disabled = false;
                }
            }
            
            animationFrame = requestAnimationFrame(step);
        }
        
        // Función para mostrar impacto
        function showImpact(riskIndex, severity, impactTop) {
            // Zona de impacto
            const impactZone = document.createElement('div');
            impactZone.className = 'impact-zone';
            impactZone.style.left = '50%';
            impactZone.style.top = `${impactTop}px`;
            
            // Tamaño basado en la energía
            const energy = parseFloat(energyValue.textContent);
            const zoneSize = Math.min(200, Math.max(50, energy / 20));
            impactZone.style.width = `${zoneSize}px`;
            impactZone.style.height = `${zoneSize}px`;
            
            // Animación de onda expansiva
            impactZone.style.animation = 'pulse 0.5s ease-out';
            
            // Añadir estilo para la animación
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0% { transform: translate(-50%, 50%) scale(0.5); opacity: 0.8; }
                    100% { transform: translate(-50%, 50%) scale(3); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            simulationArea.appendChild(impactZone);
            
            // Mostrar resultados
            resultsPanel.classList.remove('hidden');
            generateInjuryList(riskIndex, severity);
            generateProtectionEffectiveness(selectedPPE, riskIndex);
            
            // Desplazarse a resultados
            resultsPanel.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Función para calcular índice de riesgo
        function calculateRiskIndex(height, weight, surface, position, ppe) {
            let risk = height * 0.5; // Base: 0.5 por metro
            
            // Factor de peso
            risk *= (weight / 70); // Normalizado a 70kg
            
            // Factor de superficie
            const surfaceFactors = {
                concrete: 1.5,
                soil: 1.2,
                wood: 1.0,
                safetyMat: 0.3
            };
            risk *= surfaceFactors[surface] || 1.0;
            
            // Factor de posición
            const positionFactors = {
                feet: 1.0,
                side: 1.3,
                back: 1.5,
                head: 2.0
            };
            risk *= positionFactors[position] || 1.0;
            
            // Reducción por EPP
            let ppeReduction = 1.0;
            if (ppe.helmet) ppeReduction *= 0.9; // 10% reducción
            if (ppe.harness) ppeReduction = 0.1; // Arnés previene casi completamente la caída
            if (ppe.airbag) ppeReduction *= 0.5; // 50% reducción
            if (ppe.boots) ppeReduction *= 0.95; // 5% reducción
            
            risk *= ppeReduction;
            
            return parseFloat(risk.toFixed(2));
        }
        
        // Función para determinar nivel de gravedad
        function getSeverityLevel(riskIndex) {
            if (riskIndex < 1.5) return 'Leve';
            if (riskIndex < 3) return 'Moderada';
            if (riskIndex < 6) return 'Grave';
            if (riskIndex < 10) return 'Muy Grave';
            return 'Fatal';
        }
        
        // Función para actualizar resultados
        function updateResults(riskIndex, energy, velocity, severity) {
            riskValue.textContent = riskIndex;
            energyValue.textContent = Math.round(energy);
            speedValue.textContent = velocity.toFixed(1);
            severityValue.textContent = severity;
            
            // Color según gravedad
            if (severity === 'Leve') severityValue.style.color = '#2ecc71';
            else if (severity === 'Moderada') severityValue.style.color = '#f39c12';
            else if (severity === 'Grave') severityValue.style.color = '#e74c3c';
            else if (severity === 'Muy Grave') severityValue.style.color = '#c0392b';
            else severityValue.style.color = '#7d3c98';
        }
        
        // Función para generar lista de lesiones
        function generateInjuryList(riskIndex, severity) {
            injuryList.innerHTML = '';
            
            const injuries = {
                Leve: [
                    {severity: 'Leve', desc: 'Contusiones menores y hematomas'},
                    {severity: 'Leve', desc: 'Esguinces de tobillo o muñeca'},
                    {severity: 'Leve', desc: 'Abrasiones en la piel'},
                    {severity: 'Leve', desc: 'Dolor muscular por impacto'}
                ],
                Moderada: [
                    {severity: 'Moderada', desc: 'Fractura de tobillo o muñeca'},
                    {severity: 'Moderada', desc: 'Esguinces graves de rodilla'},
                    {severity: 'Moderada', desc: 'Conmoción cerebral leve'},
                    {severity: 'Moderada', desc: 'Fractura de costillas'}
                ],
                Grave: [
                    {severity: 'Grave', desc: 'Fractura de columna vertebral'},
                    {severity: 'Grave', desc: 'Traumatismo craneoencefálico'},
                    {severity: 'Grave', desc: 'Fractura de pelvis'},
                    {severity: 'Grave', desc: 'Lesiones internas y hemorragias'}
                ],
                'Muy Grave': [
                    {severity: 'Muy Grave', desc: 'Politraumatismo severo'},
                    {severity: 'Muy Grave', desc: 'Daño cerebral permanente'},
                    {severity: 'Muy Grave', desc: 'Parálisis de extremidades'},
                    {severity: 'Muy Grave', desc: 'Coma inducido por trauma'}
                ],
                Fatal: [
                    {severity: 'Fatal', desc: 'Lesiones incompatibles con la vida'},
                    {severity: 'Fatal', desc: 'Paro cardiorrespiratorio masivo'},
                    {severity: 'Fatal', desc: 'Traumatismo craneoencefálico fatal'},
                    {severity: 'Fatal', desc: 'Desangrado interno masivo'}
                ]
            };
            
            const severityInjuries = injuries[severity] || injuries['Leve'];
            
            severityInjuries.forEach(injury => {
                const injuryItem = document.createElement('div');
                injuryItem.className = 'injury-item';
                
                const severityEl = document.createElement('div');
                severityEl.className = 'injury-severity';
                severityEl.textContent = injury.severity;
                
                const descEl = document.createElement('div');
                descEl.className = 'injury-desc';
                descEl.textContent = injury.desc;
                
                injuryItem.appendChild(severityEl);
                injuryItem.appendChild(descEl);
                injuryList.appendChild(injuryItem);
            });
        }
        
        // Función para generar efectividad de protección
        function generateProtectionEffectiveness(ppe, riskIndex) {
            protectionEffect.innerHTML = '';
            
            let reduction = 0;
            let ppeUsed = [];
            
            if (ppe.helmet) {
                reduction += 10;
                ppeUsed.push('Casco');
            }
            if (ppe.harness) {
                reduction = 90; // El arnés previene la caída casi por completo
                ppeUsed.push('Arnés anticaídas');
            }
            if (ppe.airbag) {
                reduction += 50;
                ppeUsed.push('Sistema de airbag');
            }
            if (ppe.boots) {
                reduction += 5;
                ppeUsed.push('Botas de seguridad');
            }
            
            // Limitar a 95% máximo
            reduction = Math.min(reduction, 95);
            
            const title = document.createElement('h3');
            title.textContent = 'Efectividad de la Protección';
            
            const effectivenessText = document.createElement('p');
            
            if (ppeUsed.length === 0) {
                effectivenessText.innerHTML = '<strong>Sin protección:</strong> El trabajador no utilizó ningún equipo de protección personal. El riesgo de lesión es máximo.';
            } else if (ppe.harness) {
                effectivenessText.innerHTML = `<strong>Arnés anticaídas activado:</strong> Este equipo previene la caída casi por completo (90% de reducción de riesgo). El trabajador queda suspendido de forma segura.`;
            } else {
                effectivenessText.innerHTML = `<strong>Equipos utilizados:</strong> ${ppeUsed.join(', ')}<br>
                <strong>Reducción de riesgo estimada:</strong> ${reduction}%<br>
                El uso de EPP reduce significativamente la probabilidad y gravedad de lesiones.`;
            }
            
            protectionEffect.appendChild(title);
            protectionEffect.appendChild(effectivenessText);
            
            // Añadir recomendación si el riesgo es alto
            if (riskIndex > 3 && !ppe.harness) {
                const recommendation = document.createElement('p');
                recommendation.style.marginTop = '10px';
                recommendation.style.fontWeight = 'bold';
                recommendation.style.color = '#155724';
                recommendation.innerHTML = '<i class="fas fa-lightbulb"></i> Recomendación: Para trabajos en altura, el uso de arnés anticaídas es esencial y puede prevenir casi completamente las lesiones por caída.';
                protectionEffect.appendChild(recommendation);
            }
        }
        
        // Función para reiniciar simulación
        function resetSimulation() {
            simulationActive = false;
            simulateButton.disabled = false;
            slowMotion = false;
            slowMotionButton.innerHTML = '<i class="fas fa-tachometer-alt"></i> Cámara Lenta';
            
            // Limpiar área de simulación
            simulationArea.innerHTML = '';
            
            // Ocultar resultados
            resultsPanel.classList.add('hidden');
            
            // Restablecer valores por defecto
            heightSlider.value = 3;
            heightValue.textContent = '3 metros';
            weightSlider.value = 70;
            weightValue.textContent = '70 kg';
            surfaceSelect.value = 'concrete';
            positionSelect.value = 'feet';
            
            // Desactivar todos los EPP
            ppeHelmet.classList.remove('active');
            ppeHarness.classList.remove('active');
            ppeAirbag.classList.remove('active');
            ppeBoots.classList.remove('active');
            
            selectedPPE = {
                helmet: false,
                harness: false,
                airbag: false,
                boots: false
            };
            
            // Dibujar escenario inicial
            drawBuilding(3);
            drawWorker(3, 'feet');
        }
        
        // Inicializar simulación con valores por defecto
        window.onload = function() {
            drawBuilding(3);
            drawWorker(3, 'feet');
        };
    </script>
</body>
</html>